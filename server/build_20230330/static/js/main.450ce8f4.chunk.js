(this["webpackJsonpkide-stonks"]=this["webpackJsonpkide-stonks"]||[]).push([[0],{134:function(e,t,n){},135:function(e,t,n){},144:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(101),i=n.n(o),c=(n(134),n(14)),s=(n(135),n(226)),u=n(227),l=n(228),d=n(219),p=n(2),j=function(e){var t=e.setUser,n=(e.setMessage,e.setError),a=e.user,r=(e.setOpenMessageNotification,e.setOpenErrorNotification);return Object(p.jsx)(s.a,{elevation:0,sx:{backgroundColor:"white"},children:Object(p.jsxs)(u.a,{children:[Object(p.jsx)(l.a,{variant:"h5",noWrap:!0,component:"div",sx:{flexGrow:1,color:"#2a0062"},children:"KideStonks"}),null===a?null:Object(p.jsx)(d.a,{sx:{position:"absolute",backgroundColor:"white",color:"#2a0062",":hover":{backgroundColor:"#2a0062",color:"white"}},size:"small",onClick:function(){return function(){try{window.localStorage.clear(),window.location.reload(!0),fetch.setToken(""),t("")}catch(e){r(!0),n("Logged out."),setTimeout((function(){n(null)}),6e3)}}()},children:"log out"})]})})},b=n(23),x=n(31),f=n(229),m=n(212),h=n(215),O=n(51),v="https://api.kide.app/api",g=function(){var e=Object(x.a)(Object(b.a)().mark((function e(t){var n;return Object(b.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.get("".concat(v,"/products?city=").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(x.a)(Object(b.a)().mark((function e(t){var n;return Object(b.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.get("".concat(v,"/products/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(x.a)(Object(b.a)().mark((function e(t,n,a){var r,o,i;return Object(b.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={method:"POST",body:r={toCreate:[{inventoryId:t,quantity:a,productVariantUserForm:null}]},json:!0,headers:{Authorization:"Bearer ".concat(n)}},e.next=4,O.a.post("".concat(v,"/reservations"),r,o,{});case 4:return i=e.sent,console.log(i.data),e.abrupt("return",i.data);case 7:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),y={fetchEvents:g,fetchEvent:k,fetchTicket:w,setToken:function(e){"Bearer ".concat(e)}},S=function(e){var t=e.city,n=e.setCity,a=(e.events,e.setEvents),r=function(){var e=Object(x.a)(Object(b.a)().mark((function e(t){var n;return Object(b.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.fetchEvents(t);case 2:n=e.sent,a(n.model);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)(f.a,{component:"form",sx:{"& .MuiTextField-root":{m:0,margin:"100px 0px 10px auto",width:"25ch"}},noValidate:!0,autoComplete:"off",children:Object(p.jsx)("div",{children:Object(p.jsx)(m.a,{id:"outlined-select-currency",select:!0,label:"Kaupunki",value:t,onChange:function(e){n(e.target.value)},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#2a0062"},"&:hover fieldset":{borderColor:"#2a0062"},"&.Mui-focused fieldset":{borderColor:"#2a0062"}}},children:["Joensuu","Kuopio"].map((function(e){return Object(p.jsx)(h.a,{value:e,onClick:function(){return r(e)},children:Object.values(e)},e)}))})})})},C=n(220),T=function(e){var t=e.event,n=e.setEvent,a=e.setEventInfo,r=e.events;return Object(p.jsx)("div",{className:"event-menu",children:Object(p.jsx)(f.a,{component:"form",sx:{"& .MuiTextField-root":{width:"25ch",margin:"10px 0px 10px auto"}},noValidate:!0,autoComplete:"off",children:Object(p.jsx)("div",{children:Object(p.jsx)(m.a,{id:"outlined-select-currency",select:!0,label:"Tapahtuma",value:t,onChange:function(e){n(e.target.value)},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#2a0062"},"&:hover fieldset":{borderColor:"#2a0062"},"&.Mui-focused fieldset":{borderColor:"#2a0062"}}},children:r.sort((function(e,t){return t.timeUntilSalesStart-e.timeUntilSalesStart})).filter((function(e){return 1===e.productType})).map((function(e){return Object(p.jsxs)(h.a,{value:e.name,onClick:function(){return t=e.id,void y.fetchEvent(t).then((function(e){a(e.model)}));var t},sx:{width:350,whiteSpace:"normal"},children:[e.name,Object(p.jsx)(f.a,{sx:{margin:"0px 0px 0px auto"},children:0!==e.availability?Object(p.jsx)(C.a,{label:"".concat(e.availability," kpl"),color:"success",variant:"outlined"}):Object(p.jsx)(C.a,{label:"".concat(e.availability," kpl"),color:"error",variant:"outlined"})})]},e.name)}))})})})})},M=function(e){var t=e.setToken;return Object(p.jsx)(f.a,{component:"form",sx:{"& .MuiTextField-root":{width:"25ch",margin:"10px 0px 10px auto"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#2a0062"},"&:hover fieldset":{borderColor:"#2a0062"},"&.Mui-focused fieldset":{borderColor:"#2a0062"}}},noValidate:!0,autoComplete:"off",children:Object(p.jsx)("div",{children:Object(p.jsx)(m.a,{id:"outlined-helperText",placeholder:"Sy\xf6t\xe4",label:"Bearer token",sx:{"& .MuiOutlinedInput-root":{"& label":{color:"#2a0062"},"&:hover fieldset":{borderColor:"#2a0062"},"&.Mui-focused fieldset":{borderColor:"#2a0062"}}},onChange:function(e){t(e.target.value)}})})})},E=n(217),N=n(230),I=function(e){var t=e.event,n=e.token,r=e.setMessage,o=e.setError,i=e.setOpenErrorNotification,s=e.setOpenMessageNotification,u=Object(a.useState)(!1),l=Object(c.a)(u,2),d=l[0],j=l[1],b=Object(a.useRef)(!0),x=Object(a.useRef)();Object(a.useEffect)((function(){if(!b.current)return d?x.current=setInterval(m,500):clearInterval(x.current),function(){return clearInterval(x.current)};b.current=!b.current}),[d]);var m=function(){if(n)try{t.variants.map((function(e){return y.fetchTicket(e.inventoryId,n,e.productVariantMaximumReservableQuantity).then((function(t){s(!0),r("Napattiin '".concat(e.name,"' lippu.")),setTimeout((function(){r(""),s(!1)}),6e3)})).catch((function(t){401===t.response.status&&(i(!0),o("Token v\xe4\xe4rin tai puutteellinen. Anna token ilman Bearer-liitett\xe4."),setTimeout((function(){o([])}),6e3)),400===t.response.status&&(i(!0),o("Lippua '".concat(e.name,"' ei saatavilla.")),setTimeout((function(){o(""),i(!1)}),6e3))}))})),0===t.variants.length&&(i(!0),o("Myynti ei viel\xe4 alkanut."),setTimeout((function(){o([])}),6e3))}catch(e){i(!0),o("Odottamaton virhe. Mit\xe4 vittua."),setTimeout((function(){o([])}),6e3)}else i(!0),o("Token puuttuu."),setTimeout((function(){o([])}),6e3)};return Object(p.jsx)(f.a,{children:Object(p.jsxs)(f.a,{sx:{"& > button":{m:3}},children:[Object(p.jsx)(E.a,{onClick:function(){m()},variant:"contained",sx:{color:"white",backgroundColor:"#2a0062"},children:"OSTA 1x"}),Object(p.jsx)(N.a,{value:"check",size:"small",selected:d,color:"standard",onClick:function(){j(!d),d&&(s(!0),r("Lopetetaan looppaus..."),setTimeout((function(){r(""),s(!1)}),6e3)),d||(s(!0),r("Yritet\xe4\xe4n ostaa lippua joka 1s v\xe4lein..."),setTimeout((function(){r(""),s(!1)}),6e3))},onChange:function(){j(!d)},children:d?"Lopeta":"Looppaa"})]})})},B=n(225),A=n(92),W=n(223),U=n(210),z=n(221),D=n(108),F=n.n(D),L=n(222),R=n(112),V=n(224),H=function(){var e=Object(x.a)(Object(b.a)().mark((function e(t){var n;return Object(b.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J={login:H},K=function(e){return Object(p.jsxs)(l.a,Object(A.a)(Object(A.a)({variant:"body2",color:"text.secondary",align:"center"},e),{},{children:["KideStonks is behind login to prevent mass abuse :D. Copyright \xa9 ",Object(p.jsx)(z.a,{color:"inherit",href:"https://github.com/paakkis",children:"paakkis"})," ",(new Date).getFullYear(),"."]}))},q=Object(R.a)(),P=function(e){var t=e.setMessage,n=e.setError,r=e.setUser,o=e.setOpenMessageNotification,i=e.setOpenErrorNotification,s=Object(a.useState)(""),u=Object(c.a)(s,2),j=u[0],h=u[1],O=Object(a.useState)(""),v=Object(c.a)(O,2),g=v[0],k=v[1],w=function(){var e=Object(x.a)(Object(b.a)().mark((function e(a){var c;return Object(b.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,J.login({username:j,password:g});case 4:c=e.sent,window.localStorage.setItem("loggedStonkuser",JSON.stringify(c)),y.setToken(c.token),r(c),console.log(c),h(""),k(""),o(!0),t("Logged in as ".concat(c.name)),setTimeout((function(){o(!1),t(null)}),6e3),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(1),i(!0),n("Wrong username or password."),setTimeout((function(){i(!1),n(null)}),6e3);case 21:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)(V.a,{theme:q,children:Object(p.jsxs)(L.a,{component:"main",maxWidth:"xs",children:[Object(p.jsx)(U.a,{}),Object(p.jsxs)(f.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(p.jsx)(W.a,{sx:{m:1,bgcolor:"secondary.main"},children:Object(p.jsx)(F.a,{})}),Object(p.jsx)(l.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(p.jsxs)(f.a,{component:"form",onSubmit:w,noValidate:!0,sx:{mt:1},children:[Object(p.jsx)(m.a,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:j,onChange:function(e){var t=e.target;return h(t.value)}}),Object(p.jsx)(m.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",value:g,onChange:function(e){var t=e.target;return k(t.value)}}),Object(p.jsx)(d.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Sign In"})]})]}),Object(p.jsx)(K,{sx:{mt:8,mb:4}})]})})},Y=n(211),G=n(216),Q=n(213),X=function(e){var t=e.message,n=e.error,a=e.openMessageNotification,r=e.openErrorNotification,o=e.setOpenMessageNotification,i=e.setOpenErrorNotification,c=function(e,t){"clickaway"!==t&&i(!1)},s=function(e,t){"clickaway"!==t&&o(!1)};return Object(p.jsxs)(Y.a,{spacing:2,sx:{width:"100%"},children:[Object(p.jsx)(G.a,{open:r,autoHideDuration:6e3,onClose:c,children:n&&Object(p.jsx)(Q.a,{onClose:c,severity:"error",sx:{width:"100%"},children:n})}),Object(p.jsx)(G.a,{open:a,autoHideDuration:6e3,onClose:s,children:t&&Object(p.jsx)(Q.a,{onClose:s,severity:"success",sx:{width:"100%"},children:t})})]})},Z=n(232),$=n(231),_=n(234),ee=n(109),te=n.n(ee),ne=n(110),ae=n.n(ne),re=n(111),oe=n.n(re),ie=function(e){var t,n=e.event,a=new Date(n.product.dateActualFrom);return Object(p.jsxs)(B.a,{sx:{maxWidth:400,margin:"auto",marginTop:"20px",outline:"solid 2px rgb(202,191,216,0.3)"},children:[Object(p.jsx)($.a,{component:"img",height:"140",image:"https://portalvhdsp62n0yt356llm.blob.core.windows.net/bailataan-mediaitems/".concat(n.product.mediaFilename),alt:"Tapahtuman kuva"}),Object(p.jsxs)(Z.a,{children:[Object(p.jsx)(l.a,{gutterBottom:!0,variant:"h5",component:"div",children:n.product.name}),Object(p.jsx)(l.a,{gutterBottom:!0,component:"div",children:Object(p.jsx)(C.a,{label:n.company.name,color:"default",variant:"outlined"})}),Object(p.jsxs)(l.a,{gutterBottom:!0,component:"div",children:[Object(p.jsx)(te.a,{fontSize:"inherit",sx:{marginRight:1}})," ",a.toLocaleString()]}),Object(p.jsxs)(l.a,{gutterBottom:!0,component:"div",children:[Object(p.jsx)(ae.a,{fontSize:"inherit",sx:{marginRight:1}})," ",n.product.place,", ",n.product.streetAddress]})]}),Object(p.jsx)(l.a,{gutterBottom:!0,variant:"h5",children:"Lipputyypit"}),0===n.product.timeUntilSalesStart?n.variants.map((function(e){return Object(p.jsxs)(B.a,{sx:{maxWidth:380,maxHeight:100,margin:"auto",marginTop:"10px",textAlign:"left"},children:[Object(p.jsx)(l.a,{gutterBottom:!0,variant:"h7",component:"div",sx:{textAlign:"left",whiteSpace:"normal",margin:"7px 7px 7px 7px",fontWeight:500},children:e.name}),Object(p.jsxs)(f.a,{sx:{textAlign:"left",whiteSpace:"normal",margin:"7px 7px 7px 7px"},children:[0!==e.availability?Object(p.jsx)(C.a,{sx:{margin:"0px 7px 0px 0px"},label:"".concat(e.availability," %"),color:"success",variant:"outlined",size:"small"}):Object(p.jsx)(C.a,{sx:{margin:"0px 7px 0px 0px"},label:"".concat(e.availability," %"),color:"error",variant:"outlined",size:"small"}),Object(p.jsx)(C.a,{label:"".concat(e.pricePerItem/100," \u20ac"),color:"default",variant:"outlined",size:"small"})]})]})})):Object(p.jsx)(B.a,{sx:{maxWidth:380,maxHeight:100,margin:"auto",marginTop:"10px",textAlign:"left"},children:Object(p.jsxs)(l.a,{gutterBottom:!0,variant:"h7",component:"div",sx:{textAlign:"left",whiteSpace:"normal",margin:"7px 7px 7px 7px",fontWeight:500},children:["Myynti alkaa ",(t=n.product.timeUntilSalesStart,t>3600?new Date(1e3*t).toISOString().slice(11,19):t<3600?new Date(1e3*t).toISOString().slice(14,19):void 0)," kuluttua."]})}),Object(p.jsx)(_.a,{children:Object(p.jsx)(d.a,{size:"small",sx:{color:"#2a0062",marginTop:"10px"},endIcon:Object(p.jsx)(oe.a,{}),href:"https://kide.app/events/".concat(n.product.id),children:"Tapahtuman sivulle"})})]})},ce=function(){var e=Object(a.useState)(""),t=Object(c.a)(e,2),n=t[0],r=t[1],o=Object(a.useState)(""),i=Object(c.a)(o,2),s=i[0],u=i[1],l=Object(a.useState)(""),d=Object(c.a)(l,2),b=d[0],x=d[1],f=Object(a.useState)(null),m=Object(c.a)(f,2),h=m[0],O=m[1],v=Object(a.useState)([]),g=Object(c.a)(v,2),k=g[0],w=g[1],C=Object(a.useState)(null),E=Object(c.a)(C,2),N=E[0],A=E[1],W=Object(a.useState)(null),U=Object(c.a)(W,2),z=U[0],D=U[1],F=Object(a.useState)(null),L=Object(c.a)(F,2),R=L[0],V=L[1],H=Object(a.useState)(!1),J=Object(c.a)(H,2),K=J[0],q=J[1],Y=Object(a.useState)(!1),G=Object(c.a)(Y,2),Q=G[0],Z=G[1];return Object(a.useEffect)((function(){var e=window.localStorage.getItem("loggedStonkuser");if(e){var t=JSON.parse(e);V(t),y.setToken(t.token)}}),[]),null===R?Object(p.jsx)(P,{setMessage:A,setError:D,setOpenMessageNotification:Z,setOpenErrorNotification:q,setUser:V}):Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(X,{message:N,error:z,openErrorNotification:K,setOpenErrorNotification:q,openMessageNotification:Q,setOpenMessageNotification:Z}),Object(p.jsx)(j,{setMessage:A,setError:D,setUser:V,setOpenMessageNotification:Z,setOpenErrorNotification:q,user:R}),Object(p.jsxs)(B.a,{sx:{width:400,minHeight:500,margin:"auto",outline:"solid 2px rgb(202,191,216,0.3)"},children:[Object(p.jsx)(S,{setCity:r,city:n,setEvents:w}),Object(p.jsx)(T,{setEvent:u,events:k,event:s,setEventInfo:O}),Object(p.jsx)(M,{setToken:x}),Object(p.jsx)(I,{event:h,setMessage:A,setError:D,setOpenMessageNotification:Z,setOpenErrorNotification:q,token:b})]}),null===h?Object(p.jsx)(p.Fragment,{}):Object(p.jsx)(ie,{event:h})]})};i.a.createRoot(document.getElementById("root")).render(Object(p.jsx)(r.a.StrictMode,{children:Object(p.jsx)(ce,{})}))}},[[144,1,2]]]);
//# sourceMappingURL=main.450ce8f4.chunk.js.map